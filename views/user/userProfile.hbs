<section class="" style=" background-color: #f4f5f7; min-height: 100vh;">
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center">
            <div class="col col-lg-12">
                <div class="card mb-3" style="border-radius: .5rem;">
                    <div class="row g-0">
                        <div class="col-md-4 gradient-custom text-center text-white"
                            style="border-top-left-radius: .5rem; border-bottom-left-radius: .5rem;">
                            <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Avatar"
                                class="img-fluid my-5 mx-auto" style="width: 80px; border-radius: 50px;" />
                            <h5>{{user.user.username}}</h5>
                            <p>{{user.user.email}}</p>
                            <i class="far fa-edit mb-5"></i>
                        </div>
                        <div class="col-md-8">
                            <div class="card-body p-4">
                                <h6>user info</h6>
                                <hr class="mt-0 mb-4">
                                <div class="row pt-1">
                                    <div class="col-6 mb-3">
                                        <h6>user name</h6>
                                        <p class="text-muted">{{user.user.username}}</p>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <h6>email</h6>
                                        <p class="text-muted">{{user.user.email}}</p>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <h6>phone</h6>
                                        <p class="text-muted">{{user.user.phone}}</p>
                                    </div>

                                    <div class="col-6 mb-3">
                                        <a href="/user/editProfile" class="btn mt-3">edit profile</a>
                                    </div>
                                </div>
                                {{!-- <h6>Projects</h6>
                                <hr class="mt-0 mb-4">
                                <div class="row pt-1">
                                    <div class="col-6 mb-3">
                                        <h6>Recent</h6>
                                        <p class="text-muted">Lorem ipsum</p>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <h6>Most Viewed</h6>
                                        <p class="text-muted">Dolor sit amet</p>
                                    </div>
                                </div> --}}
                            </div>
                        </div>
                        <div class="row">
                            <h3 class="ml-3 my-3">
                                <strong><u>coupons</u></strong>
                            </h3>
                            <div class="grey-bg container">
                                <div class="scrolling-wrapper row flex-row flex-nowrap model" style="overflow-x: auto;">
                                    {{#each coupons}}
                                    <div class="col-xl-4 col-sm-6 col-12 my-3">
                                        <div class="card">
                                            <div class="card-content">
                                                <div class="card-body">
                                                    <div class="media d-flex">
                                                        <div class="align-self-center">
                                                            <i class="icon-pencil primary font-large-2 float-left"></i>
                                                        </div>
                                                        <div class="media-body pt-1">
                                                            <div class="">
                                                                <span>coupon valid from:
                                                                    <span>{{valid_from}}</span></span><br>
                                                                <span>cash back: <span>{{cashBack}}</span></span><br>
                                                                <h5 class="d-inline mt-3">
                                                                    {{!-- {{#if valid}}
                                                                    <strong>{{code}}</strong>
                                                                    {{else}}
                                                                    <del>
                                                                        <strong>{{code}}</strong>
                                                                    </del>
                                                                    {{/if}} --}}
                                                                    <strong>{{code}}</strong>
                                                                </h5>
                                                                <span class="badge badge-light float-right">
                                                                    <strong style="cursor: pointer;">copy</strong>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="ml-3 my-3">
                                <strong><u>Address</u></strong>
                            </h3>
                            <div class="" style="display: flex; overflow-x: auto;">
                                {{!-- --}}
                                {{#each address}}
                                <div class="m-3">
                                    <div class="card" style="width: 18rem;">
                                        <div class="card-body">
                                            {{!-- {{address.state}} <br> --}}
                                            <h5 class="card-title">{{full_name}}</h5>
                                            <p class="card-text">{{address}} {{city}} {{country}}</p>
                                            <h5> pin: {{pincode}}</h5>
                                            <a href="#" class="btn btn-primary text-white">delete</a>
                                        </div>
                                    </div>
                                </div>
                                {{/each}}
                                {{!-- --}}
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row justify-content-between mb-3">
                                <div class="col-auto">
                                    <h6 class="color-1 mb-0 change-color">Orders</h6>
                                </div>
                                {{!-- <div class="col-auto  "> <small>Receipt Voucher : 1KAU9-84UIL</small> </div> --}}
                            </div>
                            {{#each order}}
                            <div class="row my-4">
                                <div class="col">
                                    <div class="card card-2">
                                        <div class="card-body">
                                            <div class="media">
                                                <div class="sq align-self-center "> <img
                                                        class="img-fluid  my-auto align-self-center mr-2 mr-md-4 pl-0 p-0 m-0"
                                                        src="/image/productImages/{{products.mainImage}}" width="100"
                                                        height="100" /> </div>
                                                <div class="media-body my-auto text-right">
                                                    <div class="row  my-auto flex-column flex-md-row">
                                                        <div class="col my-auto">
                                                            <h6 class="mb-0">{{products.category}}</h6>
                                                        </div>
                                                        <div class="col-auto my-auto">
                                                            <small>{{products.name}}</small>
                                                        </div>
                                                        <div class="col my-auto">
                                                            <h6 class="mb-0 d-inline">&#8377;{{product_price}}</h6>
                                                            {{#if cancel_order}}
                                                            <button id="cancel-order" order-id="{{_id}}"
                                                                class="btn ml-2 btn-danger" disabled
                                                                onclick="deleteOrder(this)">{{order_status}}</button>
                                                            {{else}}
                                                            <button id="cancel-order" order-id="{{_id}}"
                                                                onclick="cancelOrder(this)"
                                                                class="btn ml-2 btn-danger">cancele order</button>
                                                            {{/if}}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <small> Track Order <span>
                                                        </span>
                                                    </small>
                                                </div>
                                                <div class="col mt-auto">
                                                    <div class="text-center" id="text-center"
                                                        style="width: {{order_completed_percentage}}%;">
                                                        <strong>{{order_status}}</strong>
                                                    </div>
                                                    <div class="progress">
                                                        {{#if cancel_order}}
                                                        <div class="progress-bar rounded"
                                                            style="width: {{order_completed_percentage}}%; background-color: #aec9f6;"
                                                            role="progressbar" aria-valuenow="25" aria-valuemin="0"
                                                            aria-valuemax="100">
                                                        </div>
                                                        {{else}}
                                                        <div class="progress-bar rounded {{_id}}"
                                                            style="width: {{order_completed_percentage}}%;"
                                                            role="progressbar" aria-valuenow="25" aria-valuemin="0"
                                                            aria-valuemax="100">
                                                        </div>
                                                        {{/if}}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>

<style>
    .scrolling-wrapper::-webkit-scrollbar {
        display: none;
    }

    .media-body h3 {
        margin: 0;
    }
</style>

<script>
    function cancelOrder(e) {
        const order_id = e.getAttribute('order-id');
        let selecter = document.getElementsByClassName(order_id)[0]

        fetch('/user/cancelOrder', {
            method: 'PATCH',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ order_id }),
        }).then(res => res.json()).then(res => {
            e.setAttribute('disabled', true)
            e.innerText = "cancelled"
            selecter.style.backgroundColor = "#aec9f6"
        })
    }

    function deleteOrder(e) {
        const order_id = e.getAttribute('order-id');
        fetch('/user/cancelOrder', {
            method: 'PATCH',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ order_id }),
        }).then(res => res.json()).then(res => {

        })
    }
</script>